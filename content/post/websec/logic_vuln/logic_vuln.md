---
title: 逻辑漏洞入门篇
comments: true
toc: true
description: 本文简要介绍业务逻辑漏洞及其挖掘姿势，并介绍授权验证绕过及密码找回等常见逻辑漏洞
categories:
    - websec
    - logic_vuln
date: 2019-10-05 15:51:20
tags:
---

逻辑漏洞博大精深，人犯的错各种各样。我们前期要做的就是总结常见的逻辑错误，后期挖逻辑漏洞挖多了，每个环节应该怎样做才能更安全，我们也就知道了。当然，最重要的还是要理解业务的逻辑，一步步理清它。

# 建议的学习方法

1. 学习并掌握常见的数据重放工具，如: Burpsuite

2. 学习并熟悉常见的业务场景。

3. 尽可能掌握业务逻辑安全的不同攻击形式。

# 定义

业务逻辑漏洞是指由于程序逻辑不严谨或逻辑太复杂，导致一些逻辑分支不能正常处理或处理错误。

通俗地讲：一个系统的功能过多，伴随着业务模块、组件的交互与共享，程序开发人员就难以思考全面，对某些地方可能有遗漏或者未能正常处理，从而导致逻辑漏洞。逻辑漏洞也可以说是程序开发人员的思路错误、程序开发人员的逻辑存在漏洞。

# 特点

业务逻辑漏洞是非常隐蔽的，它不像 SQL 注入、XSS 跨站脚本攻击、命令执行、文件上传漏洞等有鲜明的标识。自动化扫描器可以定义一系列的规则识别出这些漏洞，而业务逻辑漏洞一般出现在功能（业务流程）上，这是漏洞扫描工具无法识别的。

业务逻辑漏洞出现于业务流程中（模块功能），也就是说，网站的任何部分都有可能存在着逻辑错误漏洞。比如，修改个人资料就完全可能出现逻辑错误漏洞。

大致分类：用户模块、交易支付模块

用户模块：

1）密码注册、找回、修改、重置，邮箱绑定

2）头像上传等资料的修改

可能存在的漏洞：任意账户注册、任意密码重置、找回、任意邮箱绑定、CSRF 修改可以 Self XSS 的资料、越权访问、修改，当然，也可能涉及 XSS，SQL injection，文件上传等其他漏洞。

注：重置邮箱或者使用邮箱找回密码时，如果发到邮箱的是链接且一些参数没有使用太复杂的加密，八成存在漏洞。

交易支付模块：

1）选择商品，下单，付款

2）优惠券

可能存在的漏洞：商品数目支付漏洞（正负数目抵消）、优惠券型支付漏洞（可以伪造优惠券）、金额修改支付漏洞

业务模块大致分为：用户模块、交易支付模块，**可以采用以下攻击流程对每个模块逐一测试。**（每个模块，过一遍下面的流程，因为如果你要把所有模块再过一遍，数据报比较多，比较乱，不容易分析。）

# 测试流程

1. 正常操作并记录数据包

    按照正常操作流程，记录其数据包

2. 分析数据包

    分析数据包，找到数据宝忠的敏感部分

3. 分析程序验证机制

    分析猜测程序后台所采用的验证机制、手段

4. 修改源数据包

    修改源数据包，验证推测是否成功

# 常见挖掘姿势

黑客在挖掘业务逻辑漏洞时的一般操作步骤如下：

1）发现网站所提供的功能模块。比如，修改密码、找回密码、修改个人资料等功能。
2）针对具体的功能确定业务流程，详细划分具体步骤，以购物为例介绍，购物流程如下：

> 挑选商品，商品可多选；
> 立刻购买，在“立刻购买”按钮旁边可以选择购买数量、购买样式等；
> 显示购买信息，在此步骤可以给卖家留言，填写购买数量、使用优惠券、匿名购买、找人付款；
> 提交订单；
> 付款。

3）拦截 HTTP/HTTPS 请求，分析其参数项的含义；
4）修改参数值，尝试触发业务逻辑漏洞；
5）返回前面步骤，对其他功能继续测试。

密码重置

![](https://blog-1259556217.cos.ap-chengdu.myqcloud.com/blog/BlogPic/Web%E5%AE%89%E5%85%A8/login_vuln/pass_reset.png)

支付交易

![](https://blog-1259556217.cos.ap-chengdu.myqcloud.com/blog/BlogPic/Web%E5%AE%89%E5%85%A8/login_vuln/order_proc.png)

# 授权验证绕过

检测手段

-   授权访问
-   未授权访问

## 未授权访问

非授权访问是指用户在没有通过认证授权的情况下能够直接访问需要通过认证才能访问到的页面或文本信息。尝试将一些敏感的页面链接复制于其他浏览器或其他电脑上进行访问，看是否能访问成功。

## 越权访问

1. 垂直越权（垂直越权是指使用权限低的用户可以访问权限较高的用户）
2. 水平越权（水平越权是指相同权限的不同用户可以互相访问）

# 密码找回

1）密码找回的凭证（验证码）太弱，如只需要填入一个四位或者六位的纯数字就可以重置密码，导致可以暴力破解。
2）密码找回凭证可从客户端直接获取。
3）密码找回凭证在页面中可以直接获取。
4）用户找回密码的邮箱地址或者手机号码被修改。
5）在最后提交修改的密码处的逻辑错误。
